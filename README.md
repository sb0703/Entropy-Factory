# 熵工厂（Flutter 增量游戏）

一个以“碎片 → 零件 → 蓝图 → 定律”为核心循环的增量放置类游戏，包含升维、研究、常数强化、挑战升维、技能树等系统。

## 主要特性
- 资源循环：采集、转化、合成与定律生成
- 能量硬约束与优先级分配
- 设施协同与邻接布局系统
- 主动技能与被动技能树（装配与快捷启用）
- 升维系统：常数强化、挑战升维、永久解锁
- 大数值计算层（BigNumber）
- 离线收益与本地存档（Hive）
- 粒子与升维过场动画

## 功能清单
- 资源生产：碎片/零件/蓝图/定律实时产出与自动转化
- 能量系统：过载硬约束、分配比例与优先级模式
- 建筑购买：单次/批量/最大可买，成本曲线与产能反馈
- 研究系统：多分支解锁、前置条件与永久增益
- 设施协同：布局格位、邻接加成与模块槽解锁
- 升维机制：收益预估、常数加成、保留与重置清单提示
- 挑战升维：挑战目标、永久解锁奖励、双重确认启动
- 技能系统：技能树解锁、技能点兑换、装配槽位限制
- 主动技能：时间扭曲/手动超频/资源脉冲，冷却与持续时长
- 被动技能：产能/效率/能耗/成本增幅等多类加成
- 运行变体：随机机制修正，影响当轮产能与效率
- 离线收益：自动结算与上线提示
- 存档系统：本地存档、旧存档自动迁移
- 视觉反馈：粒子飞入、过场动画、资源条提示

## 待开发功能（对照 flutter_plan_v2）
- 自动化脚本/规则化操作（Gambits）
- 星图探索与变体星球规则
- 剧情碎片与里程碑叙事
- 云存档与跨设备同步
- 广告激励（非强制加速/离线收益翻倍）

## 运行

```bash
flutter pub get
flutter run
```

## 存档迁移
首次运行会自动将旧的 `shared_preferences` 存档迁移到 Hive。

## 目录结构
- `lib/game/` 核心数值与规则
- `lib/ui/` 界面与动效
- `lib/services/` 存档与服务
- `flutter_plan_v2.md` 设计与后续规划

## 主要文件快速阅读
- `lib/main.dart` 应用入口与初始化
- `lib/game/game_controller.dart` 游戏主循环、模拟与存档调度
- `lib/game/game_state.dart` 核心状态与序列化
- `lib/game/game_math.dart` 产能/消耗计算与邻接加成
- `lib/game/research_definitions.dart` 研究定义、效果与文案
- `lib/game/skill_definitions.dart` 技能定义与效果
- `lib/ui/home_shell.dart` 主框架、导航与全局 UI
- `lib/ui/tabs/production_tab.dart` 生产与建造页面
- `lib/ui/tabs/research_tab.dart` 研究页面（弹出购买）
- `lib/ui/tabs/skill_tab.dart` 技能树页面（装配与详情）
- `lib/ui/tabs/prestige_tab.dart` 升维与挑战页面
- `lib/ui/widgets/resource_bar.dart` 资源条与警报提示
- `lib/ui/widgets/layout_panel.dart` 设施布局与邻接网格

## 说明
本项目用于原型验证与迭代开发，UI 与数值仍在持续调整中。

## 开发路线图
- V0.9：完善挑战升维与永久解锁效果（模块槽可配置、挑战奖励多样化）
- V1.0：扩展“宇宙探索/星图”与新资源链
- V1.1：加入剧情碎片与里程碑叙事
- V1.2：高阶自动化（规则式/脚本化）
- V1.3：云存档与跨设备同步（可选）

## 版本记录                                      
- 2026-01-22
  - 大数值计算层（BigNumber）接入
  - 游戏循环分离：高频模拟 + 低频 UI 刷新
  - 存档迁移至 Hive（含旧存档自动迁移）
  - 挑战升维与永久解锁框架（含双重确认）
  - 粒子与升维过场动画优化
  - 技能树与快捷启用入口（装配与槽位限制）
  - 研究卡片支持弹出面板购买
  - 研究弹出层调整为宽度撑满显示
  - 研究弹出层卡片宽度占满屏幕
  - 研究卡片边框仅在选中时显示
  - 研究卡片选中态改为背景高亮，移除蓝色描边
  - 变体卡片改为占满宽度显示
- 2026-01-23
  - 更新功能文档 features_overview.md
  - 能量可视化与瓶颈提示增强（流光负载条 + 警告提示）
  - 关键操作加入轻量触感反馈
  - 长按购买支持连续购买
  - 新增碎片采集器与进阶设施（重型挖掘机/量子钻机/纳米熔炉）
  - 修复建筑定义中文乱码
  - 按钮反馈与尺寸规范统一（主题按钮样式）
  - 主导航与离线收益文案修正
  - 离线收益弹窗支持内容滚动
  - 修复入口文件包导入路径
  - 主题按钮样式切换至 WidgetStateProperty
  - 购买按钮取消高亮填充，统一为描边样式
  - 能量可视化深化：流光管道 + 过载态波动
  - 离线收益公式化结算强化（日志含离线时长）
  - 修复设施协同注释乱码并补充布局协同说明
  - 导入解析异常排查（协同与配比模块）
  - 设施协同计算合并至 game_math 以稳定引用
  - 配比面板内联到生产页以规避导入解析异常
