# Flutter Plan V3 执行计划整理

基于 `flutter_plan_v3.md` 中的建议，整理为可执行的迭代计划，按优先级与依赖拆分为阶段任务。

## 总体目标
- 强化核心玩法的策略深度（布局协同、变体词条、技能节奏）
- 提升 UI/UX 反馈与可视化（拖拽、HUD、数值展示）
- 稳定技术基建（存档、BigNumber 性能、离线收益）

## 阶段规划

### P0 核心体验完善（必须先做）
1) 设施布局与协同
- 动态扩容：从 3x3 起步，研究/升维解锁边缘格
- 邻接可视化：相邻加成连线/高亮提示
- 负面邻接规则：高能辐射建筑削弱周围 4 格

2) 变体词条（Run Variants）
- 词条分层：正面 / 负面 / 混沌 三类
- 启动前可刷新词条（有限次数）
- 词条效果影响布局与技能（如禁用主动技能、建筑占地 +1）

3) 技能节奏优化
- Auto-cast：技能树深层解锁自动施放
- 全局冷却（GCD）：一键触发全装配技能，冷却更长

4) UI/UX 基线体验
- 设施拖拽与交换逻辑
- 编辑模式切换（显示网格/隐藏网格）
- 购买反馈：粒子曲线飞入资源条

交付验收：
- 布局系统可用且有协同/惩罚反馈
- 词条能改变策略路线
- 技能操作频率下降但收益明确

### P1 体验深度与留存增强
1) 技能快捷 HUD
- Overlay 常驻 HUD（跨页面显示）
- 快捷触发与状态提示（剩余时间/冷却）

2) 顶部数值展示优化
- FittedBox 自适应
- 可展开详情视图（点击展开完整数值）

3) 星图探索（Map System）
- 星球分流玩法：能源型 / 机械型等
- 不同星球影响产出与资源结构

交付验收：
- HUD 不遮挡主交互
- 数值在极大规模下仍可读
- 星图分流有明确差异化

### P2 长线与商业化准备
1) 云存档
- 账号绑定或设备同步方案预研
- 迁移流程与冲突处理策略

2) Gambits（自动化）
- 轻量规则系统（IF/THEN）
- UI 规则编辑器原型

交付验收：
- 云存档可用并可回滚
- Gambits 能覆盖基础自动化需求

## 技术专项
1) Hive 存档迁移
- 引入 version 字段
- 兼容旧存档默认值补齐
- Grid/复杂对象 TypeAdapter 完整

2) BigNumber 计算性能
- 选择库：`break_infinity` 或 `decimal`
- 输出缓存（Memoization）
- 输出更新条件最小化

3) 离线收益
- 公式化计算替代逐秒模拟
- 时间篡改保护（本地校验 + 服务端时间预留）

## 里程碑建议
- M1：P0 全部完成 + 基本可玩
- M2：P1 完成 + 可视化与留存提升
- M3：P2 完成 + 长线与运营支撑

## 风险与依赖
- 布局拖拽与协同可视化对 UI 性能要求较高
- BigNumber 与离线收益需统一数据结构，避免重复实现
- Gambits 需建立在稳定的规则数据模型之上
